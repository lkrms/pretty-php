# Rules

Formatting rules applied by `pretty-php` are as follows.

This file is generated by [generate.sh][], so any changes should be made there or to [get-rules.php][].

> Suggested priority ranges:
>
> - 0-99: normalise content, suppress illegal whitespace, save data for later
> - 100-199: apply horizontal whitespace, unconditional vertical whitespace
> - 200-299: apply vertical whitespace
> - 300-399: apply indentation, register alignment callbacks
> - 400-499: apply preset-specific formatting
> - 500-599: process blocks
> - 600: process alignment callbacks
> - 601-699: process other callbacks
> - 900-999: finalise

| Rule                        | Mandatory? | Default? | Pass | Method                  | Priority |
| --------------------------- | ---------- | -------- | ---- | ----------------------- | -------- |
| `NormaliseComments`         | Y          | -        | 1    | `processTokens()`       | 40       |
| `NormaliseStrings`          | -          | Y        | 1    | `processTokens()`       | 42       |
| `NormaliseNumbers`          | -          | Y        | 1    | `processTokens()`       | 44       |
| `ProtectStrings`            | Y          | -        | 1    | `processTokens()`       | 60       |
| `FormatHeredocs` (1)        | Y          | -        | 1    | `processTokens()`       | 62       |
| `IndexSpacing`              | Y          | -        | 1    | `processTokens()`       | 100      |
| `OperatorSpacing`           | Y          | -        | 1    | `processTokens()`       | 102      |
| `StandardSpacing` (1)       | Y          | -        | 1    | `processTokens()`       | 104      |
| `StandardSpacing` (2)       | Y          | -        | 1    | `processDeclarations()` | 104      |
| `StatementSpacing`          | Y          | -        | 1    | `processTokens()`       | 120      |
| `ControlStructureSpacing`   | Y          | -        | 1    | `processTokens()`       | 122      |
| `PlaceBraces` (1)           | Y          | -        | 1    | `processTokens()`       | 124      |
| `PlaceComments` (1)         | Y          | -        | 1    | `processTokens()`       | 126      |
| `PreserveNewlines`          | -          | Y        | 1    | `processTokens()`       | 200      |
| `PreserveOneLineStatements` | -          | -        | 1    | `processStatements()`   | 202      |
| `BlankBeforeReturn`         | -          | -        | 1    | `processTokens()`       | 204      |
| `VerticalSpacing` (1)       | Y          | -        | 1    | `processList()`         | 220      |
| `VerticalSpacing` (2)       | Y          | -        | 1    | `processDeclarations()` | 220      |
| `StrictExpressions`         | -          | -        | 1    | `processTokens()`       | 222      |
| `SemiStrictExpressions`     | -          | -        | 1    | `processTokens()`       | 224      |
| `StrictLists`               | -          | -        | 1    | `processList()`         | 226      |
| `PlaceBrackets`             | Y          | -        | 1    | `processTokens()`       | 240      |
| `VerticalSpacing` (3)       | Y          | -        | 1    | `processTokens()`       | 242      |
| `AlignChains` (1)           | -          | -        | 1    | `processTokens()`       | 280      |
| `DeclarationSpacing`        | -          | Y        | 1    | `processDeclarations()` | 299      |
| `StandardIndentation`       | Y          | -        | 1    | `processTokens()`       | 300      |
| `SwitchIndentation`         | Y          | -        | 1    | `processTokens()`       | 302      |
| `AlignArrowFunctions` (1)   | -          | -        | 1    | `processTokens()`       | 320      |
| `AlignLists` (1)            | -          | -        | 1    | `processList()`         | 322      |
| `AlignTernaryOperators` (1) | -          | -        | 1    | `processTokens()`       | 324      |
| `HangingIndentation` (1)    | Y          | -        | 1    | `processTokens()`       | 380      |
| `Symfony` (1)               | -          | -        | 1    | `processTokens()`       | 400      |
| `Symfony` (2)               | -          | -        | 1    | `processList()`         | 400      |
| `Drupal` (1)                | -          | -        | 1    | `processTokens()`       | 420      |
| `Drupal` (2)                | -          | -        | 1    | `processDeclarations()` | 420      |
| `Laravel`                   | -          | -        | 1    | `processTokens()`       | 440      |
| `WordPress`                 | -          | -        | 1    | `processTokens()`       | 480      |
| `AlignComments` (1)         | -          | -        | 2    | `processBlock()`        | 500      |
| `AlignData` (1)             | -          | -        | 2    | `processBlock()`        | 520      |
| `AlignChains` (2)           | -          | -        | 3    | _`callback`_            | 600      |
| `AlignArrowFunctions` (2)   | -          | -        | 3    | _`callback`_            | 600      |
| `AlignLists` (2)            | -          | -        | 3    | _`callback`_            | 600      |
| `AlignTernaryOperators` (2) | -          | -        | 3    | _`callback`_            | 600      |
| `AlignData` (2)             | -          | -        | 3    | _`callback`_            | 600      |
| `HangingIndentation` (2)    | Y          | -        | 3    | _`callback`_            | 680      |
| `StandardSpacing` (3)       | Y          | -        | 3    | _`callback`_            | 699      |
| `PlaceBraces` (2)           | Y          | -        | 4    | `beforeRender()`        | 920      |
| `FormatHeredocs` (2)        | Y          | -        | 4    | `beforeRender()`        | 980      |
| `PlaceComments` (2)         | Y          | -        | 4    | `beforeRender()`        | 997      |
| `AlignComments` (2)         | -          | -        | 4    | `beforeRender()`        | 998      |
| `EssentialSpacing`          | Y          | -        | 4    | `beforeRender()`        | 999      |

## Descriptions

### `NormaliseComments`

<small>(mandatory, `processTokens()`, priority 40, tokens: `T_COMMENT` | `T_DOC_COMMENT`)</small>

In one-line C-style comments (`/*`), unnecessary asterisks are removed from both delimiters, the remaining content is trimmed, and a space is added between delimiters and adjacent content.

Region markers recognised by VS Code, including C++-style comments like `//region`, are converted to shell-style `#region` or `#endregion` comments if necessary, otherwise they are not modified.

Shell-style comments (`#`) are converted to C++-style comments (`//`).

In C++-style comments (`//`), a space is added between the delimiter and adjacent content if horizontal whitespace is not already present.

DocBlocks are normalised for PSR-5 compliance as follows:

- An asterisk is added to the start of each line that doesn't have one. The indentation of undelimited lines relative to each other is maintained if possible.
- If every line starts and ends with an asterisk, trailing asterisks are removed.
- Trailing whitespace is removed from each line.
- The content of each DocBlock is applied to its token as `COMMENT_CONTENT` data.
- DocBlocks with one line of content are collapsed to a single line unless they appear to describe a file or have a subsequent named declaration. In the latter case, the `COLLAPSIBLE_COMMENT` flag is applied.

Multi-line C-style comments where every line starts with an asterisk, or at least one delimiter appears on its own line, receive the same treatment as DocBlocks.

> Multi-line C-style comments that do not meet this criteria are trimmed and may be reindented by the renderer.

### `NormaliseStrings`

<small>(default, `processTokens()`, priority 42, tokens: `"` | `T_ENCAPSED_AND_WHITESPACE` | `T_CONSTANT_ENCAPSED_STRING` | `T_START_HEREDOC`)</small>

Double quotes and leading whitespace are removed from heredoc and nowdoc labels, and binary prefixes are removed from all strings.

Strings other than nowdocs are normalised as follows:

- Single- and double-quoted strings are replaced with the most readable and economical syntax. Single-quoted strings are preferred unless escaping is required or the double-quoted equivalent is shorter.
- Backslash escapes are added in contexts where they improve safety, consistency and readability, otherwise they are removed if possible.
- Aside from leading and continuation bytes in valid UTF-8 strings, control characters and non-ASCII characters are backslash-escaped using hexadecimal notation with lowercase digits.
- In valid UTF-8 strings, invisible characters that don't belong to an extended grapheme cluster (e.g. an emoji sequence) are backslash-escaped using Unicode notation with uppercase digits.

### `NormaliseNumbers`

<small>(default, `processTokens()`, priority 44, tokens: `T_LNUMBER` | `T_DNUMBER`)</small>

Integer literals are normalised by replacing hexadecimal, octal and binary prefixes with `0x`, `0` and `0b` respectively, removing redundant zeroes, and converting hexadecimal digits to uppercase.

Float literals are normalised by removing redundant zeroes, adding `0` to empty integer or fractional parts, replacing `E` with `e`, removing `+` from exponents, and expressing them with mantissae between 1.0 and 10.

If an underscore is present in the input, underscores are applied to decimal values with no exponent every 3 digits, to hexadecimal values with more than 5 digits every 4 digits, and to binary values every 4 digits.

### `ProtectStrings`

<small>(mandatory, `processTokens()`, priority 60, tokens: `"` | `` ` `` | `T_START_HEREDOC`)</small>

In non-constant strings, whitespace between tokens is suppressed for inner siblings, and for every token between square brackets. (The latter is necessary because strings like `"$foo[0]"` and `"$foo[$bar]"` are unparseable if there is any whitespace between the brackets.)

### `FormatHeredocs` (1)

<small>(mandatory, `processTokens()`, priority 62, tokens: `T_START_HEREDOC`)</small>

If the formatter's `HeredocIndent` property has a value other than `NONE`, heredocs are saved for later processing.

### `IndexSpacing`

<small>(mandatory, `processTokens()`, priority 100)</small>

Leading and/or trailing spaces are:

- added to tokens in the formatter's `AddSpace`, `AddSpaceBefore` and `AddSpaceAfter` indexes
- suppressed, along with blank lines, for tokens in the `SuppressSpaceBefore` and `SuppressSpaceAfter` indexes, and inside brackets other than structural and `match` braces

Blank lines are also suppressed inside alternative syntax blocks.

### `OperatorSpacing`

<small>(mandatory, `processTokens()`, priority 102, tokens: `!` | `$` | `%` | `&` | `*` | `+` | `-` | `.` | `/` | `:` | `<` | `=` | `>` | `?` | `@` | `^` | `|` | `~` | `T_LOGICAL_OR` | `T_LOGICAL_XOR` | `T_LOGICAL_AND` | `T_INSTANCEOF` | `T_PLUS_EQUAL` | `T_MINUS_EQUAL` | `T_MUL_EQUAL` | `T_DIV_EQUAL` | `T_CONCAT_EQUAL` | `T_MOD_EQUAL` | `T_AND_EQUAL` | `T_OR_EQUAL` | `T_XOR_EQUAL` | `T_SL_EQUAL` | `T_SR_EQUAL` | `T_COALESCE_EQUAL` | `T_BOOLEAN_OR` | `T_BOOLEAN_AND` | `T_IS_EQUAL` | `T_IS_NOT_EQUAL` | `T_IS_IDENTICAL` | `T_IS_NOT_IDENTICAL` | `T_IS_SMALLER_OR_EQUAL` | `T_IS_GREATER_OR_EQUAL` | `T_SPACESHIP` | `T_SL` | `T_SR` | `T_INC` | `T_DEC` | `T_DOUBLE_ARROW` | `T_COALESCE` | `T_POW` | `T_POW_EQUAL` | `T_PIPE` | `T_AMPERSAND_FOLLOWED_BY_VAR_OR_VARARG` | `T_AMPERSAND_NOT_FOLLOWED_BY_VAR_OR_VARARG`)</small>

Operators in `declare` expressions are ignored.

Whitespace is suppressed:

- after reference-related ampersands
- before and after operators in union, intersection and DNF types
- between parentheses in DNF types
- before and after exception delimiters in `catch` blocks (unless strict PSR-12 mode is enabled)
- after `?` in nullable types
- between `++` and `--` and the variables they operate on
- after other unary operators
- before `:` in short ternary expressions, e.g. `$a ?: $b`

A space is added:

- before reference-related ampersands (except in arrow functions)
- before DNF types that start with an open parenthesis
- before `?` in nullable types
- before and after `:` in standard ternary expressions
- after `:` in other contexts

Spaces are added before and after operators not mentioned above.

### `StandardSpacing` (1)

<small>(mandatory, `processTokens()`, priority 104, tokens: `,` | `T_FOR` | `T_DECLARE` | `T_MATCH` | `T_ATTRIBUTE` | `T_OPEN_TAG` | `T_OPEN_TAG_WITH_ECHO` | `T_CLOSE_TAG` | `T_START_HEREDOC` | `T_ATTRIBUTE_COMMENT`)</small>

If the indentation level of an open tag aligns with a tab stop, and a close tag is found in the same scope (or the document has no close tag, and the open tag is in the global scope), a callback is registered to align nested tokens with it. An additional level of indentation is applied if the formatter's `IndentBetweenTags` property is `true`.

If a `<?php` tag is followed by a `declare` statement, they are collapsed to one line. This is only applied in strict PSR-12 mode if the `declare` statement is `declare(strict_types=1);` (semicolon optional), followed by a close tag.

Statements between open and close tags on the same line are preserved as one-line statements, even if they contain constructs that would otherwise break over multiple lines. Similarly, if a pair of open and close tags are both adjacent to code on the same line, newlines between code and tags are suppressed. Otherwise, inner newlines are added to open and close tags.

Whitespace is applied to other tokens as follows:

- **Commas:** leading whitespace is suppressed, and trailing spaces are added.
- **`declare` expressions:** whitespace is suppressed between parentheses.
- **`for` loops:** whitespace in empty expressions is suppressed.
- **`match` expressions:** newlines are added after delimiters between arms.
- **Attributes:** in parameters, property hooks, anonymous functions and arrow functions, spaces are added before and after attributes, and trailing blank lines are suppressed. For other attributes, leading and trailing newlines are added.
- **Heredocs:** leading newlines are suppressed in strict PSR-12 mode.

### `StandardSpacing` (2)

<small>(mandatory, `processDeclarations()`, priority 104, declarations: `PROPERTY` | `PARAM`)</small>

If a constructor has one or more promoted parameters, a newline is added before every parameter.

If a property has unimplemented hooks with no modifiers or attributes (e.g. `public $Foo { &get; set; }`), they are collapsed to one line, otherwise hooks with statements are formatted like anonymous functions, and hooks that use abbreviated syntax are formatted like arrow functions.

### `StatementSpacing`

<small>(mandatory, `processTokens()`, priority 120, tokens: `:` | `;`)</small>

In `for` loop expressions, a space is added after semicolons where the next expression is not empty.

For semicolons in other contexts, and colons in alternative syntax constructs, `switch` cases and labels, leading whitespace is suppressed and trailing newlines are added.

### `ControlStructureSpacing`

<small>(mandatory, `processTokens()`, priority 122, tokens: `T_IF` | `T_ELSEIF` | `T_ELSE` | `T_DO` | `T_WHILE` | `T_FOR` | `T_FOREACH` | `T_DECLARE`)</small>

If the body of a control structure has no enclosing braces:

- a newline is added after the body (if empty), or before and after the body (if non-empty)
- blank lines before the body are suppressed
- blank lines after the body are suppressed if the control structure continues

### `PlaceBraces` (1)

<small>(mandatory, `processTokens()`, priority 124, tokens: `{`)</small>

Whitespace is applied to structural and `match` expression braces as follows:

- Blank lines are suppressed after open braces and before close braces.
- Newlines are added after open braces.
- Newlines are added after close braces unless they belong to a `match` expression or a control structure that is immediately continued, e.g. `} else {`. In the latter case, trailing newlines are suppressed.
- Empty class, function and property hook bodies are collapsed to ` {}` on the same line as the declaration they belong to unless the formatter's `CollapseEmptyDeclarationBodies` property is `false`.
- Horizontal whitespace is suppressed between other empty braces.

> Open brace placement is handled by `VerticalSpacing`, which runs after newlines are applied by other rules.

### `PlaceComments` (1)

<small>(mandatory, `processTokens()`, priority 126, tokens: `T_COMMENT` | `T_DOC_COMMENT`)</small>

Critical newlines are added after one-line comments followed by any token other than a close tag.

Newlines are added before and after:

- DocBlocks
- comments with a leading newline in the input
- comments after top-level close braces (if strict PSR-12 mode is enabled)

These comments are also saved for alignment with the next code token (unless it's a close bracket).

Leading and trailing spaces are added to comments that don't appear on their own line, and comments where the previous token is a code token are saved to receive padding derived from the value of the formatter's `SpacesBesideCode` property if they are the last token on the line after other rules are applied.

For multi-line DocBlocks, and C-style comments that receive the same treatment:

- leading blank lines are added unless the comment appears mid-statement (deferred until after `DeclarationSpacing` for collapsible DocBlocks)
- trailing blank lines are added to file-level comments
- trailing blank lines are suppressed for DocBlocks with subsequent code

### `PreserveNewlines`

<small>(default, `processTokens()`, priority 200, tokens: `* (except virtual)`)</small>

If a newline in the input is adjacent to a token in the formatter's `AllowNewlineBefore` or `AllowNewlineAfter` indexes, it is applied to the token as a leading or trailing newline on a best-effort basis. This has the effect of placing operators before or after newlines as per the formatter's token index.

Similarly, blank lines in the input are preserved between tokens in the `AllowBlankBefore` and `AllowBlankAfter` indexes, except:

- after `:` if there is a subsequent token in the same scope
- after `,` other than between `match` expression arms
- after `;` in `for` expressions
- before and after mid-statement comments and comments in non-statement scopes

### `PreserveOneLineStatements`

<small>(optional, `processStatements()`, priority 202)</small>

Newlines are suppressed between tokens in statements and control structures that start and end on the same line in the input.

If a `switch` case and its statement list are on the same line in the input, they are treated as one statement.

Attributes on their own line are excluded from consideration.

For any control structures that remain where every `if`/`elseif`/`else` or `try`/`catch`/`finally` statement starts and ends on the same line in the input:

- newlines are added before each `elseif`/`else`/`catch`/`finally` token
- newlines are suppressed between tokens in each statement
- blank lines are added before and after the control structure

### `BlankBeforeReturn`

<small>(optional, `processTokens()`, priority 204, tokens: `T_YIELD` | `T_YIELD_FROM` | `T_RETURN`)</small>

Blank lines are added before non-consecutive `return`, `yield` and `yield from` statements.

### `VerticalSpacing` (1)

<small>(mandatory, `processList()`, priority 220)</small>

If interface lists break over multiple lines and neither `StrictLists` nor `AlignLists` are enabled, a newline is added before the first interface.

Arrays and argument lists with trailing ("magic") commas are split into one item per line.

If parameter lists have one or more attributes with a trailing newline, every attribute is placed on its own line, and blank lines are added before and after annotated parameters to improve readability.

### `VerticalSpacing` (2)

<small>(mandatory, `processDeclarations()`, priority 220, declarations: `CONST` | `USE` | `PROPERTY` | `PARAM` | `USE_CONST` | `USE_FUNCTION` | `USE_TRAIT`)</small>

Newlines are added between comma-delimited constant declarations and property declarations. When neither `StrictLists` nor `AlignLists` are enabled, they are also added to `use` statements between comma-delimited imports and trait insertions that break over multiple lines.

If a list of property hooks has one or more attributes with a trailing newline, every attribute is placed on its own line, and blank lines are added before and after annotated hooks to improve readability.

### `StrictExpressions`

<small>(optional, `processTokens()`, priority 222, tokens: `T_IF` | `T_ELSEIF` | `T_WHILE` | `T_FOR` | `T_FOREACH` | `T_SWITCH`)</small>

Newlines are added before and after control structure expressions that break over multiple lines. In `for` expressions that break over multiple lines, newlines are also added after semicolons between expressions.

### `SemiStrictExpressions`

<small>(optional, `processTokens()`, priority 224, tokens: `T_IF` | `T_ELSEIF` | `T_WHILE` | `T_FOR` | `T_FOREACH` | `T_SWITCH`)</small>

Newlines are added before and after control structure expressions with newlines between siblings. In `for` expressions that break over multiple lines, newlines are also added after semicolons between expressions.

> Unlike `StrictExpressions`, this rule does not apply leading and trailing newlines to expressions that would not break over multiple lines if tokens between brackets were removed.

### `StrictLists`

<small>(optional, `processList()`, priority 226)</small>

Items in lists are arranged horizontally or vertically by replicating the arrangement of the first and second items.

### `PlaceBrackets`

<small>(mandatory, `processTokens()`, priority 240, tokens: `(` | `[` | `{` | `T_ATTRIBUTE` | `T_DOLLAR_OPEN_CURLY_BRACES` | `T_CURLY_OPEN`)</small>

Inner whitespace is copied from open brackets to close brackets.

Structural and `match` expression braces are ignored.

### `VerticalSpacing` (3)

<small>(mandatory, `processTokens()`, priority 242, tokens: `&` | `?` | `^` | `{` | `|` | `T_LOGICAL_OR` | `T_LOGICAL_XOR` | `T_LOGICAL_AND` | `T_FOR` | `T_USE` | `T_BOOLEAN_OR` | `T_BOOLEAN_AND` | `T_OBJECT_OPERATOR` | `T_NULLSAFE_OBJECT_OPERATOR` | `T_PIPE` | `T_AMPERSAND_FOLLOWED_BY_VAR_OR_VARARG` | `T_AMPERSAND_NOT_FOLLOWED_BY_VAR_OR_VARARG`)</small>

In expressions where one or more boolean operators have an adjacent newline, newlines are added to other boolean operators of equal or lower precedence.

In `for` loops:

- If an expression with multiple expressions breaks over multiple lines, newlines are added after comma-delimited expressions, and blank lines are added after semicolon-delimited expressions.
- Otherwise, if an expression breaks over multiple lines, newlines are added after semicolon-delimited expressions.
- Otherwise, if the second or third expression has a leading newline, a newline is added before the other.

Newlines are added before open braces that belong to top-level declarations and anonymous classes declared over multiple lines.

Newlines are added before both operators in ternary expressions where one operator has a leading newline.

In anonymous functions with lexical variables after parameters that break over multiple lines, newlines are added before each parameter. If the list of variables after `use` breaks over multiple lines, newlines are also added before each variable.

In pipe chains where a pipe operator (`|>`) has a leading newline, newlines are added before every pipe operator.

In method chains where an object operator (`->` or `?->`) has a leading newline, newlines are added before every object operator. If the `AlignChains` rule is enabled and strict PSR-12 compliance is not, the first object operator in the chain is excluded from this operation.

### `AlignChains` (1)

<small>(optional, `processTokens()`, priority 280, tokens: `T_OBJECT_OPERATOR` | `T_NULLSAFE_OBJECT_OPERATOR`)</small>

If there are no object operators with a leading newline in a chain of method calls, no action is taken.

Otherwise, if the first object operator in the chain has a leading newline, it is removed if horizontal space on subsequent lines would be saved. Then, a callback is registered to align object operators in the chain with:

- the first object operator (if it has no leading newline)
- the expression dereferenced by the first object operator (if it doesn't break over multiple lines), or
- the first token on the line before the first object operator

### `DeclarationSpacing`

<small>(default, `processDeclarations()`, priority 299, declarations: `CASE` | `CLASS` | `CONST` | `DECLARE` | `ENUM` | `FUNCTION` | `INTERFACE` | `NAMESPACE` | `TRAIT` | `USE` | `PROPERTY` | `HOOK` | `USE_CONST` | `USE_FUNCTION` | `USE_TRAIT`)</small>

One-line declarations with a collapsed or collapsible DocBlock, or no DocBlock at all, are considered "collapsible". Declarations that break over multiple lines or have a DocBlock that cannot be collapsed to one line are considered "non-collapsible".

"Tight" spacing is applied by suppressing blank lines between collapsible declarations of the same type when they appear consecutively and:

- the formatter's `TightDeclarationSpacing` property is `true`, or
- there is no blank line in the input between the first and second declarations in the group

DocBlocks in tightly-spaced groups are collapsed to a single line.

Otherwise, "loose" spacing is applied by adding blank lines between declarations.

Blank lines are also added before and after each group of declarations. They are suppressed between `use` statements, one-line `declare` statements, and property hooks not declared over multiple lines.

### `StandardIndentation`

<small>(mandatory, `processTokens()`, priority 300, tokens: `*`)</small>

`Indent` is copied from open brackets to close brackets, and the `Indent` of tokens between brackets with inner newlines is incremented.

### `SwitchIndentation`

<small>(mandatory, `processTokens()`, priority 302, tokens: `T_SWITCH`)</small>

In switch case lists:

- The `PreIndent` of every token is incremented.
- The `Deindent` of tokens between `case` or `default` and their respective delimiters is incremented.
- Newlines are added before `case` and `default` and after their respective delimiters.
- Blank lines are suppressed after `case` and `default` delimiters.

### `AlignArrowFunctions` (1)

<small>(optional, `processTokens()`, priority 320, tokens: `T_FN`)</small>

If an arrow function expression starts on a new line, a callback is registered to align it with the `fn` it's associated with, or with the first token on the previous line if its arguments break over multiple lines.

### `AlignLists` (1)

<small>(optional, `processList()`, priority 322)</small>

A callback is registered to align arguments, array elements and other list items, along with their inner and adjacent tokens, with the column after their open brackets, or with the first item in the list if they have no enclosing brackets.

### `AlignTernaryOperators` (1)

<small>(optional, `processTokens()`, priority 324, tokens: `?` | `T_COALESCE`)</small>

If a ternary or null coalescing operator has a leading newline, a callback is registered to align it with its expression, or with the first token on the previous line if its expression breaks over multiple lines.

### `HangingIndentation` (1)

<small>(mandatory, `processTokens()`, priority 380, tokens: `*`)</small>

Scopes and expressions that would otherwise be difficult to differentiate from adjacent code are indented for visual separation, and a callback is registered to collapse any unnecessary "overhanging" indentation levels.

### `Symfony` (1)

<small>(optional, `processTokens()`, priority 400, tokens: `.` | `T_FN`)</small>

Trailing spaces are added to `fn` in arrow functions.

Leading and trailing spaces are suppressed for `.` operators.

### `Symfony` (2)

<small>(optional, `processList()`, priority 400)</small>

Newlines are suppressed in parameter lists with no promoted constructor parameters and no trailing comma.

### `Drupal` (1)

<small>(optional, `processTokens()`, priority 420, tokens: `T_ELSEIF` | `T_ELSE` | `T_CATCH` | `T_FINALLY` | `T_DOC_COMMENT`)</small>

Blank lines are added after DocBlocks with a `@file` tag.

Newlines are added after close braces with a subsequent `elseif`, `else`, `catch` or `finally`.

### `Drupal` (2)

<small>(optional, `processDeclarations()`, priority 420, declarations: `CLASS` | `ENUM` | `INTERFACE` | `TRAIT`)</small>

Blank lines are added inside non-empty `class`, `enum`, `interface` and `trait` braces.

### `Laravel`

<small>(optional, `processTokens()`, priority 440, tokens: `!` | `.` | `T_FN`)</small>

Trailing spaces are added to:

- `!` operators
- `fn` in arrow functions

Leading and trailing spaces are suppressed for `.` operators.

### `WordPress`

<small>(optional, `processTokens()`, priority 480, tokens: `!` | `(` | `:` | `[` | `{` | `T_COMMENT` | `T_DOC_COMMENT`)</small>

Suppression of blank lines after DocBlocks is removed for the first DocBlock in each document.

Blank lines added before DocBlocks by other rules are removed.

Leading spaces are added to `:` in alternative syntax constructs.

Trailing spaces are added to `!` operators.

Suppression of blank lines inside braces is removed.

Spaces are added inside non-empty:

- parentheses
- square brackets (except in strings or when they enclose one inner token that is not a variable)

### `AlignComments` (1)

<small>(optional, `processBlock()`, priority 500)</small>

Comments beside code, along with any continuations on subsequent lines, are saved for alignment.

C++- and shell-style comments on their own line after a comment beside code are treated as continuations of the initial comment if they are of the same type and were indented by at least one column relative to code in the same context.

### `AlignData` (1)

<small>(optional, `processBlock()`, priority 520)</small>

When they appear in the same scope, a callback is registered to align consecutive:

- assignment operators (except as noted below)
- `=>` delimiters in array syntax (except as noted below)
- `=>` delimiters in `match` expressions

If the open bracket of an array or parameter list is not followed by a newline and neither `AlignLists` nor `StrictLists` are enabled, its `=>` delimiters or assignment operators are ignored.

### `AlignChains` (2)

<small>(optional, _`callback`_, priority 600)</small>

Object operators in a chain of method calls are aligned with a given token.

This is achieved by:

- calculating the difference between the first object operator's current output column and its desired output column
- applying it to the `LinePadding` of each object operator and its adjacent tokens
- incrementing `LineUnpadding` for any `?->` operators, to accommodate the extra character

### `AlignArrowFunctions` (2)

<small>(optional, _`callback`_, priority 600)</small>

Tokens in arrow function expressions are aligned with the `fn` they're associated with, or with the first token on the previous line if its arguments break over multiple lines.

This is achieved by:

- calculating the difference between the current and desired output columns of the first token in the expression
- applying it to the `LinePadding` of each token

### `AlignLists` (2)

<small>(optional, _`callback`_, priority 600)</small>

List items are aligned with the column after their open bracket, or with the first item in the list if they have no enclosing brackets.

This is achieved by:

- calculating the difference between the current and desired output columns of each item
- applying it to the `LinePadding` of the item and its adjacent tokens

### `AlignTernaryOperators` (2)

<small>(optional, _`callback`_, priority 600)</small>

Ternary and null coalescing operators with leading newlines are aligned with their expressions, or with the first token on the previous line if their expressions break over multiple lines.

This is achieved by:

- calculating the difference between the current and desired output columns of the operator
- applying it to the `LinePadding` of the operator and its adjacent tokens

### `AlignData` (2)

<small>(optional, _`callback`_, priority 600)</small>

Assignment operators are aligned unless the formatter's `MaxAssignmentPadding` property is not `null` and would be exceeded.

In arrays and `match` expressions, `=>` delimiters are aligned unless the formatter's `MaxDoubleArrowColumn` property is not `null`, in which case any found in subsequent columns are excluded from consideration.

Alignment is achieved by:

- calculating the difference between the current and desired output columns of each token
- applying it to the `Padding` of the token

### `HangingIndentation` (2)

<small>(mandatory, _`callback`_, priority 680)</small>

"Overhanging" indentation applied earlier is collapsed to the minimum level required to ensure distinct scopes and expressions do not appear to run together.

### `StandardSpacing` (3)

<small>(mandatory, _`callback`_, priority 699)</small>

The `TagIndent` of tokens between indented tags is adjusted by the difference, if any, between the open tag's indent and the indentation level of the first token after the open tag.

### `PlaceBraces` (2)

<small>(mandatory, `beforeRender()`, priority 920)</small>

In function declarations where `)` and `{` appear at the start of consecutive lines, they are collapsed to the same line.

### `FormatHeredocs` (2)

<small>(mandatory, `beforeRender()`, priority 980)</small>

The indentation of the first inner token of each heredoc saved earlier is applied to the heredoc by adding whitespace after newline characters in each of its tokens. (Whitespace added to each heredoc is also applied to the `HeredocIndent` property of its `T_START_HEREDOC` token, which allows inherited indentation to be removed when processing nested heredocs.)

### `PlaceComments` (2)

<small>(mandatory, `beforeRender()`, priority 997)</small>

Placement of comments saved earlier is finalised.

A level of indentation is added to comments before `switch` cases unless they appear after the opening brace of the switch, between a blank line and the next case, or after a statement that unconditionally exits the previous case.

### `AlignComments` (2)

<small>(optional, `beforeRender()`, priority 998)</small>

Comments saved for alignment are aligned with the rightmost comment in the block.

### `EssentialSpacing`

<small>(mandatory, `beforeRender()`, priority 999)</small>

Newlines and spaces are added after tokens that would otherwise fail to parse. This is to ensure that if an edge case not covered by other rules arises, formatter output can still be parsed.

## `TokenRule` classes, by token

| Token                                       | Rules                                                                                                         |
| ------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| `*`                                         | `HangingIndentation`, `StandardIndentation`                                                                   |
| `* (except virtual)`                        | `PreserveNewlines`                                                                                            |
| `T_AMPERSAND_FOLLOWED_BY_VAR_OR_VARARG`     | `VerticalSpacing`                                                                                             |
| `T_AMPERSAND_NOT_FOLLOWED_BY_VAR_OR_VARARG` | `VerticalSpacing`                                                                                             |
| `T_AND`                                     | `VerticalSpacing`                                                                                             |
| `T_ATTRIBUTE`                               | `PlaceBrackets`, `StandardSpacing`                                                                            |
| `T_ATTRIBUTE_COMMENT`                       | `StandardSpacing`                                                                                             |
| `T_BACKTICK`                                | `ProtectStrings`                                                                                              |
| `T_BOOLEAN_AND`                             | `VerticalSpacing`                                                                                             |
| `T_BOOLEAN_OR`                              | `VerticalSpacing`                                                                                             |
| `T_CATCH`                                   | `Drupal`                                                                                                      |
| `T_CLOSE_TAG`                               | `StandardSpacing`                                                                                             |
| `T_COALESCE`                                | `AlignTernaryOperators`                                                                                       |
| `T_COLON`                                   | `StatementSpacing`, `WordPress`                                                                               |
| `T_COMMA`                                   | `StandardSpacing`                                                                                             |
| `T_COMMENT`                                 | `NormaliseComments`, `PlaceComments`, `WordPress`                                                             |
| `T_CONCAT`                                  | `Laravel`, `Symfony`                                                                                          |
| `T_CONSTANT_ENCAPSED_STRING`                | `NormaliseStrings`                                                                                            |
| `T_CURLY_OPEN`                              | `PlaceBrackets`                                                                                               |
| `T_DECLARE`                                 | `ControlStructureSpacing`, `StandardSpacing`                                                                  |
| `T_DNUMBER`                                 | `NormaliseNumbers`                                                                                            |
| `T_DO`                                      | `ControlStructureSpacing`                                                                                     |
| `T_DOC_COMMENT`                             | `Drupal`, `NormaliseComments`, `PlaceComments`, `WordPress`                                                   |
| `T_DOLLAR_OPEN_CURLY_BRACES`                | `PlaceBrackets`                                                                                               |
| `T_DOUBLE_QUOTE`                            | `NormaliseStrings`, `ProtectStrings`                                                                          |
| `T_ELSE`                                    | `ControlStructureSpacing`, `Drupal`                                                                           |
| `T_ELSEIF`                                  | `ControlStructureSpacing`, `Drupal`, `SemiStrictExpressions`, `StrictExpressions`                             |
| `T_ENCAPSED_AND_WHITESPACE`                 | `NormaliseStrings`                                                                                            |
| `T_FINALLY`                                 | `Drupal`                                                                                                      |
| `T_FN`                                      | `AlignArrowFunctions`, `Laravel`, `Symfony`                                                                   |
| `T_FOR`                                     | `ControlStructureSpacing`, `SemiStrictExpressions`, `StandardSpacing`, `StrictExpressions`, `VerticalSpacing` |
| `T_FOREACH`                                 | `ControlStructureSpacing`, `SemiStrictExpressions`, `StrictExpressions`                                       |
| `T_IF`                                      | `ControlStructureSpacing`, `SemiStrictExpressions`, `StrictExpressions`                                       |
| `T_LNUMBER`                                 | `NormaliseNumbers`                                                                                            |
| `T_LOGICAL_AND`                             | `VerticalSpacing`                                                                                             |
| `T_LOGICAL_NOT`                             | `Laravel`, `WordPress`                                                                                        |
| `T_LOGICAL_OR`                              | `VerticalSpacing`                                                                                             |
| `T_LOGICAL_XOR`                             | `VerticalSpacing`                                                                                             |
| `T_MATCH`                                   | `StandardSpacing`                                                                                             |
| `T_NULLSAFE_OBJECT_OPERATOR`                | `AlignChains`, `VerticalSpacing`                                                                              |
| `T_OBJECT_OPERATOR`                         | `AlignChains`, `VerticalSpacing`                                                                              |
| `T_OPEN_BRACE`                              | `PlaceBraces`, `PlaceBrackets`, `VerticalSpacing`, `WordPress`                                                |
| `T_OPEN_BRACKET`                            | `PlaceBrackets`, `WordPress`                                                                                  |
| `T_OPEN_PARENTHESIS`                        | `PlaceBrackets`, `WordPress`                                                                                  |
| `T_OPEN_TAG`                                | `StandardSpacing`                                                                                             |
| `T_OPEN_TAG_WITH_ECHO`                      | `StandardSpacing`                                                                                             |
| `T_OR`                                      | `VerticalSpacing`                                                                                             |
| `T_PIPE`                                    | `VerticalSpacing`                                                                                             |
| `T_QUESTION`                                | `AlignTernaryOperators`, `VerticalSpacing`                                                                    |
| `T_RETURN`                                  | `BlankBeforeReturn`                                                                                           |
| `T_SEMICOLON`                               | `StatementSpacing`                                                                                            |
| `T_START_HEREDOC`                           | `FormatHeredocs`, `NormaliseStrings`, `ProtectStrings`, `StandardSpacing`                                     |
| `T_SWITCH`                                  | `SemiStrictExpressions`, `StrictExpressions`, `SwitchIndentation`                                             |
| `T_USE`                                     | `VerticalSpacing`                                                                                             |
| `T_WHILE`                                   | `ControlStructureSpacing`, `SemiStrictExpressions`, `StrictExpressions`                                       |
| `T_XOR`                                     | `VerticalSpacing`                                                                                             |
| `T_YIELD`                                   | `BlankBeforeReturn`                                                                                           |
| `T_YIELD_FROM`                              | `BlankBeforeReturn`                                                                                           |

## `DeclarationRule` classes, by declaration type

| Declaration    | Rules                                                      |
| -------------- | ---------------------------------------------------------- |
| `CASE`         | `DeclarationSpacing`                                       |
| `CLASS`        | `DeclarationSpacing`, `Drupal`                             |
| `CONST`        | `DeclarationSpacing`, `VerticalSpacing`                    |
| `DECLARE`      | `DeclarationSpacing`                                       |
| `ENUM`         | `DeclarationSpacing`, `Drupal`                             |
| `FUNCTION`     | `DeclarationSpacing`                                       |
| `HOOK`         | `DeclarationSpacing`                                       |
| `INTERFACE`    | `DeclarationSpacing`, `Drupal`                             |
| `NAMESPACE`    | `DeclarationSpacing`                                       |
| `PARAM`        | `StandardSpacing`, `VerticalSpacing`                       |
| `PROPERTY`     | `DeclarationSpacing`, `StandardSpacing`, `VerticalSpacing` |
| `TRAIT`        | `DeclarationSpacing`, `Drupal`                             |
| `USE`          | `DeclarationSpacing`, `VerticalSpacing`                    |
| `USE_CONST`    | `DeclarationSpacing`, `VerticalSpacing`                    |
| `USE_FUNCTION` | `DeclarationSpacing`, `VerticalSpacing`                    |
| `USE_TRAIT`    | `DeclarationSpacing`, `VerticalSpacing`                    |

[generate.sh]: ../scripts/generate.sh
[get-rules.php]: ../scripts/get-rules.php
